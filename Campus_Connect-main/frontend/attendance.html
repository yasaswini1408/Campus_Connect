<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mark Attendance</title>
  <link rel="icon" href="assets/images/icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary: #e67e22;
      --highlight: #f1c40f;
      --dark: #34495e;
      --bg: #fffaf5;
      --card: #ffffff;
      --muted: #7f8c8d;
      --border: #e6ddd0;
      --radius:14px;
      --shadow: 0 18px 40px rgba(2,6,23,0.06);
      --left-w: 1.28fr;
      --right-w: 0.72fr;
      --maxw:1100px;
    }

    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background: linear-gradient(180deg,var(--bg), #fffefb);
      color:var(--dark);
      padding:34px 18px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      justify-content:center;
    }

    .wrap{ width:100%; max-width:var(--maxw); }

    header{
      display:flex; gap:16px; align-items:center; margin-bottom:20px;
    }
    .badge{
      width:68px; height:68px; border-radius:14px; display:grid; place-items:center;
      background: linear-gradient(135deg,var(--primary), var(--highlight));
      color:#111; font-weight:800; font-size:26px; box-shadow:0 12px 36px rgba(230,126,34,0.12);
    }
    h1{ margin:0; font-size:22px; font-weight:700; color:var(--dark); }
    p.lead{ margin:6px 0 0; color:var(--muted); font-size:13px; }

    main{
      display:grid;
      grid-template-columns: var(--left-w) var(--right-w);
      gap:22px;
      align-items:start;
    }
    @media (max-width:1024px){ main{ grid-template-columns: 1fr; } header{ gap:12px; } }

    /* Left: form + attendance */
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:14px;
    }

    .section-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .title{ display:flex; gap:12px; align-items:center; }
    .title .icon{
      width:48px; height:48px; border-radius:10px; display:grid; place-items:center;
      background: linear-gradient(135deg,var(--primary),var(--highlight)); color:#111; font-weight:800;
      box-shadow: 0 8px 24px rgba(230,126,34,0.12);
    }
    .title h2{ margin:0; text-transform:uppercase; color:var(--primary); font-size:15px; font-weight:800; }
    .title .sub{ color:var(--muted); font-size:13px; font-weight:600; }

    form.controls{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; align-items:end; }
    @media (max-width:720px){ form.controls{ grid-template-columns: 1fr; } }

    label{ display:block; font-weight:600; color:var(--dark); margin-bottom:6px; font-size:13px; }
    input[type=date], select, input[type=number]{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid var(--border);
      background:linear-gradient(180deg,#fff,#fffefc); font-size:14px; color:var(--dark);
      outline:none; box-shadow: 0 6px 18px rgba(2,6,23,0.02);
      transition: box-shadow .14s, border-color .12s, transform .08s;
    }
    input:focus, select:focus{ border-color:var(--primary); box-shadow: 0 10px 26px rgba(230,126,34,0.07); transform:translateY(-2px); }

    .load-btn{
      padding:12px 14px; border-radius:10px; border:none; cursor:pointer;
      font-weight:800; background: linear-gradient(90deg,var(--primary), var(--highlight)); color:#111;
      box-shadow: 0 12px 30px rgba(230,126,34,0.12); transition: transform .12s;
    }
    .load-btn:hover{ transform:translateY(-4px); box-shadow: 0 18px 40px rgba(230,126,34,0.16); }

    /* Attendance box */
    .attendance{
      margin-top:6px; padding:14px; border-radius:12px; border:1px solid var(--border);
      background: linear-gradient(180deg,#fff,#fffefb);
    }
    .attendance h3{ margin:0 0 12px; color:var(--primary); font-weight:700; font-size:16px; }

    .controls-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
    .small{ color:var(--muted); font-size:13px; }

    /* table style */
    .table-wrap{ overflow:auto; border-radius:10px; border:1px solid var(--border); }
    table{ width:100%; border-collapse:collapse; min-width:540px; }
    thead th{
      background: linear-gradient(90deg,var(--primary),var(--highlight));
      color:#111; font-weight:800; padding:12px; text-align:center; text-transform:uppercase; font-size:12px;
      letter-spacing:0.6px;
    }
    tbody tr{ background:var(--card); transition: transform .12s, box-shadow .14s; }
    tbody tr:hover{ transform:translateY(-6px); box-shadow: 0 12px 26px rgba(2,6,23,0.04); }
    td{ padding:12px; border-bottom:1px solid var(--border); font-size:14px; color:var(--dark); }
    td.center{ text-align:center; }
    td.name{ font-weight:600; color:var(--dark); max-width:220px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

    .checkbox{
      width:20px; height:20px; accent-color:var(--primary); cursor:pointer; border-radius:5px;
    }

    .actions{ display:flex; gap:12px; margin-top:14px; align-items:center; }
    .post-btn{
      flex:1; padding:12px 16px; border-radius:12px; border:none; cursor:pointer;
      background: linear-gradient(90deg,#27ae60,#2ecc71); color:#fff; font-weight:800; box-shadow:0 12px 30px rgba(46,204,113,0.12);
    }
    .post-btn:hover{ transform:translateY(-4px); }

    .small-muted{ font-size:13px; color:var(--muted); }

    /* right column */
    .aside{ display:flex; flex-direction:column; gap:14px; }
    .card-compact{ padding:14px; border-radius:12px; background:var(--card); border:1px solid var(--border); box-shadow:var(--shadow); }
    .stat{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .stat .num{ font-weight:800; color:var(--primary); font-size:18px; }
    .stat .lbl{ color:var(--muted); font-weight:600; }

    .history{ display:flex; flex-direction:column; gap:10px; margin-top:8px; max-height:340px; overflow:auto; padding-right:6px; }
    .history-item{
      display:flex; justify-content:space-between; align-items:center; padding:10px; border-radius:10px; border:1px solid var(--border);
      background:linear-gradient(180deg,#fff,#fffefb);
    }
    .chip{ padding:6px 10px; border-radius:10px; background: linear-gradient(135deg,var(--primary),var(--highlight)); color:#111; font-weight:800; min-width:72px; text-align:center; }

    /* responsive adjustments */
    @media (max-width:720px){
      .badge{ width:56px; height:56px; font-size:20px; }
      .chip{ min-width:64px; padding:6px 8px; }
      table{ min-width:420px; }
    }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Mark Attendance dashboard">
    <header>
      <div class="badge" aria-hidden="true">üìÖ</div>
      <div>
        <h1>Mark Attendance</h1>
        <p class="lead">Select date, subject and periods ‚Äî load students and mark present/absent.</p>
      </div>
    </header>

    <main>
      <!-- LEFT: main controls and attendance -->
      <section class="card" aria-labelledby="main-heading">
        <div class="section-head">
          <div class="title">
            <div class="icon" aria-hidden="true">üìù</div>
            <div>
              <h2 id="main-heading">Attendance</h2>
              <div class="sub small">Quickly load students and mark attendance</div>
            </div>
          </div>
          <div class="small-muted">Your changes are auto-saved locally for this session</div>
        </div>

        <form id="loadForm" class="controls" onsubmit="return false;">
          <div>
            <label for="date">Date</label>
            <input id="date" type="date" value="" required />
          </div>

          <div>
            <label for="subject">Subject</label>
            <select id="subject" required>
              <option value="">-- Select Subject --</option>
              <option value="DWDM">DWDM (Data Warehousing and Data Mining)</option>
              <option value="CD">CD (Compiler Design)</option>
              <option value="DAA">DAA (Design & Analysis of Algorithms)</option>
              <option value="OOAD">OOAD (Object-Oriented Analysis & Design)</option>
              <option value="AOS">AOR (Advanced Operating Systems)</option>
              <option value="DM_LAB">DM LAB</option>
              <option value="ADS_LAB">ADS LAB</option>
              <option value="FSD2_LAB">FSD-II LAB</option>
              <option value="AADF">AADF</option>
            </select>
          </div>

          <div>
            <label for="periods">Number of Periods</label>
            <input id="periods" type="number" min="1" max="6" value="1" required />
          </div>

          <div style="grid-column: 1 / -1; display:flex; justify-content:flex-end; gap:8px;">
            <button id="loadBtn" class="load-btn" type="button">Load Students</button>
          </div>
        </form>

        <div id="attendanceBox" class="attendance" style="display:none;">
          <h3>Mark Attendance</h3>

          <div class="controls-row">
            <div class="small-muted" id="infoSelected">Subject: ‚Äî ‚Ä¢ Date: ‚Äî ‚Ä¢ Periods: ‚Äî</div>
            <div style="margin-left:auto" class="small">
              <label style="font-weight:600; display:inline-block; margin-right:8px;">Show only absentees</label>
              <input id="filterAbs" type="checkbox" />
            </div>
          </div>

          <div class="table-wrap" role="region" aria-label="Students table">
            <table>
              <thead>
                <tr>
                  <th style="width:120px">Reg No</th>
                  <th style="min-width:220px">Name</th>
                  <th style="width:120px">Absent?</th>
                </tr>
              </thead>
              <tbody id="studentsTbody">
                <!-- rows inserted by JS -->
              </tbody>
            </table>
          </div>

          <div class="actions">
            <div class="small-muted">Total students: <span id="totalCount">0</span></div>
            <button id="postBtn" class="post-btn">Post Attendance</button>
          </div>
        </div>
      </section>

      <!-- RIGHT: stats and recent -->
      <aside class="aside">
        <div class="card-compact">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-weight:800; color:var(--dark);">Summary</div>
              <div class="small-muted">Session quick stats</div>
            </div>
            <div class="num" id="summaryNum" style="font-weight:900;color:var(--primary);">‚Äî</div>
          </div>

          <div style="margin-top:12px" class="stat">
            <div class="lbl">Loaded students</div>
            <div id="loadedCount" class="num">0</div>
          </div>

          <div class="stat">
            <div class="lbl">Marked absent</div>
            <div id="absentCount" class="num">0</div>
          </div>
        </div>

        <div class="card-compact">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
              <div style="font-weight:800; color:var(--dark)">Recent Loads</div>
              <div class="small-muted">Last actions</div>
            </div>
            <div style="color:var(--muted); font-weight:700" id="recentCount">0</div>
          </div>

          <div class="history" id="recentList" aria-live="polite">
            <!-- entries added by JS -->
          </div>

          <div style="margin-top:8px; display:flex; gap:8px;">
            <button id="clearBtn" class="load-btn" style="flex:1; background:#fff; border:1px solid var(--border); box-shadow:none; color:var(--dark);">Clear</button>
            <button id="exportBtn" class="load-btn" style="flex:1">Export CSV</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <script>
    (function(){
      // demo students data (replace with backend load)
      const demoStudents = [
        { reg: '21A01', name: 'Aarav Kumar' },
        { reg: '21A02', name: 'Bhavya R' },
        { reg: '21A03', name: 'Chitra S' },
        { reg: '21A04', name: 'Devraj P' },
        { reg: '21A05', name: 'Esha M' },
        { reg: '21A06', name: 'Farhan A' }
      ];

      const dateInput = document.getElementById('date');
      const subjectSelect = document.getElementById('subject');
      const periodsInput = document.getElementById('periods');
      const loadBtn = document.getElementById('loadBtn');
      const attendanceBox = document.getElementById('attendanceBox');
      const studentsTbody = document.getElementById('studentsTbody');
      const infoSelected = document.getElementById('infoSelected');
      const totalCount = document.getElementById('totalCount');
      const loadedCount = document.getElementById('loadedCount');
      const absentCount = document.getElementById('absentCount');
      const recentList = document.getElementById('recentList');
      const recentCount = document.getElementById('recentCount');
      const filterAbs = document.getElementById('filterAbs');
      const postBtn = document.getElementById('postBtn');
      const exportBtn = document.getElementById('exportBtn');
      const clearBtn = document.getElementById('clearBtn');

      let currentStudents = [];
      let recentActions = [];

      // set today's date default
      dateInput.valueAsDate = new Date();

      function renderStudents(list){
        studentsTbody.innerHTML = '';
        list.forEach((s, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="center">${s.reg}</td>
            <td class="name" title="${s.name}">${s.name}</td>
            <td class="center">
              <input type="checkbox" class="checkbox absent-checkbox" data-idx="${idx}" ${s.absent ? 'checked' : ''} />
            </td>
          `;
          studentsTbody.appendChild(tr);
        });
        totalCount.textContent = list.length;
        loadedCount.textContent = list.length;
        updateAbsentCount();
      }

      function updateAbsentCount(){
        const count = currentStudents.filter(s => s.absent).length;
        absentCount.textContent = count;
      }

      function addRecent(action){
        const now = new Date();
        recentActions.unshift({ action, time: now.toLocaleString() });
        if(recentActions.length > 6) recentActions.pop();
        renderRecent();
      }

      function renderRecent(){
        recentList.innerHTML = '';
        recentActions.forEach(r => {
          const div = document.createElement('div');
          div.className = 'history-item';
          div.innerHTML = `<div style="font-weight:700">${r.action}</div><div style="color:var(--muted)">${r.time}</div>`;
          recentList.appendChild(div);
        });
        recentCount.textContent = recentActions.length;
      }

      loadBtn.addEventListener('click', () => {
        const date = dateInput.value;
        const subject = subjectSelect.value;
        const periods = periodsInput.value;

        if(!date){ alert('Please select a date'); return; }
        if(!subject){ alert('Please select a subject'); return; }

        // simulate loading students (replace with AJAX)
        currentStudents = demoStudents.map(s => ({ ...s, absent: false }));
        renderStudents(currentStudents);

        attendanceBox.style.display = 'block';
        infoSelected.textContent = `Subject: ${subject} ‚Ä¢ Date: ${new Date(date).toLocaleDateString()} ‚Ä¢ Periods: ${periods}`;
        addRecent(`Loaded: ${subject} (${new Date(date).toLocaleDateString()})`);
      });

      // toggle absent checkbox
      document.addEventListener('change', (e) => {
        if(e.target.matches('.absent-checkbox')){
          const idx = Number(e.target.dataset.idx);
          currentStudents[idx].absent = e.target.checked;
          updateAbsentCount();
          addRecent(`${currentStudents[idx].reg} ${e.target.checked ? 'marked absent' : 'marked present'}`);
          if(filterAbs.checked) applyFilterAbs();
        }
      });

      filterAbs.addEventListener('change', applyFilterAbs);
      function applyFilterAbs(){
        if(filterAbs.checked){
          const absList = currentStudents.filter(s => s.absent);
          renderStudents(absList);
        } else {
          renderStudents(currentStudents);
        }
      }

      postBtn.addEventListener('click', () => {
        if(!attendanceBox.style.display || attendanceBox.style.display === 'none'){ alert('Load students first'); return; }
        // collect data
        const payload = {
          date: dateInput.value,
          subject: subjectSelect.value,
          periods: periodsInput.value,
          records: currentStudents
        };
        // optimistic UI: add a recent action
        addRecent(`Posted attendance for ${subjectSelect.value} (${new Date(dateInput.value).toLocaleDateString()})`);
        alert('Attendance posted (demo). In production this would send data to server.');
        // save to localStorage as a simple persistence
        const key = 'attendance_history_demo';
        const hist = JSON.parse(localStorage.getItem(key) || '[]');
        hist.unshift({ meta: `${subjectSelect.value} ‚Ä¢ ${dateInput.value}`, time: new Date().toLocaleString(), records: payload.records });
        localStorage.setItem(key, JSON.stringify(hist.slice(0, 20)));
      });

      exportBtn.addEventListener('click', () => {
        if(!currentStudents.length){ alert('No data to export'); return; }
        // CSV export
        let csv = 'reg_no,name,absent\n';
        currentStudents.forEach(s => { csv += `${s.reg},"${s.name}",${s.absent ? 1 : 0}\n`; });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `attendance_${Date.now()}.csv`; document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      clearBtn.addEventListener('click', () => {
        if(!confirm('Clear current selection and UI?')) return;
        attendanceBox.style.display = 'none';
        studentsTbody.innerHTML = '';
        currentStudents = [];
        totalCount.textContent = 0;
        loadedCount.textContent = 0;
        absentCount.textContent = 0;
        addRecent('Cleared UI');
      });

      // hydrate recent actions from localStorage demo history
      (function loadHistory(){
        const key = 'attendance_history_demo';
        const hist = JSON.parse(localStorage.getItem(key) || '[]');
        hist.slice(0,5).forEach(h => addRecent(`Posted: ${h.meta}`));
      })();

    })();
  </script>
</body>
</html>