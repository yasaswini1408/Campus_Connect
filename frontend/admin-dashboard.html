<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
    h2 { margin-bottom: 20px; }
    input, select, button {
      width: 100%; margin: 10px 0; padding: 10px;
    }
    .user-list { margin-top: 20px; }
    .user { padding: 10px; border-bottom: 1px solid #ddd; }
    .logout { background: #e63946; color: white; border: none; border-radius: 6px; cursor: pointer; padding: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin Dashboard</h2>

    <form id="addUserForm">
  <input type="text" id="name" placeholder="Name" required>
  <input type="text" id="regNo" placeholder="Registration Number" required>
  <input type="password" id="password" placeholder="Password" required>

  <select id="role" required onchange="toggleStudentFields()">
    <option value="">-- Select Role --</option>
    <option value="student">Student</option>
    <option value="faculty">Faculty</option>
    <option value="admin">Admin</option>
  </select>

  <div id="studentFields" style="display:none;">
    <input type="number" id="year" placeholder="Year">
    <input type="text" id="branch" placeholder="Branch">
    <input type="text" id="section" placeholder="Section">
  </div>

  <button type="submit">Add User</button>
</form>

<div class="bokka" onclick="window.location.href='admin-library.html'">Add Books</div>

<script>
function toggleStudentFields() {
  const role = document.getElementById('role').value;
  document.getElementById('studentFields').style.display =
    (role === 'student') ? 'block' : 'none';
}

document.getElementById('addUserForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = document.getElementById('name').value;
  const regNo = document.getElementById('regNo').value;
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value;

  let body = { name, regNo, password, role };

  if (role === 'student') {
    body.year = document.getElementById('year').value;
    body.branch = document.getElementById('branch').value;
    body.section = document.getElementById('section').value;
  }

  try {
    const res = await fetch('http://localhost:3000/api/admin/add-user', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    alert(data.msg);
    e.target.reset();
    toggleStudentFields(); // hide extra fields again
  } catch (err) {
    console.error(err);
  }
});
</script>
</body>
</html>
